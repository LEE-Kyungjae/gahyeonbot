# Gahyeonbot API λ¬Έμ„

## κ°μ”
κ°€ν„λ΄‡μ€ Discord λ΄‡μΌλ΅ μ£Όλ μΈν„°νμ΄μ¤λ” Discord μ¬λμ‹ λ…λ Ήμ–΄μ΄μ§€λ§, μ΄μ λ° λ¨λ‹ν„°λ§μ„ μ„ν• HTTP REST APIλ¥Ό μ κ³µν•©λ‹λ‹¤.

**Base URL**: `/api`
**ν”„λ΅ν† μ½**: HTTP/HTTPS
**ν¬νΈ**: 8080 (Blue), 8081 (Green)

## μΈμ¦
ν„μ¬ REST APIλ” μΈμ¦μ΄ ν•„μ”ν•μ§€ μ•μµλ‹λ‹¤. (λ‚΄λ¶€ Health Check μ©λ„)

ν–¥ν›„ κ΄€λ¦¬μ API ν™•μ¥ μ‹ μΈμ¦ λ©”μ»¤λ‹μ¦ μ¶”κ°€ μμ •.

---

## REST API Endpoints

### Health Check

#### `GET /api/health`
μ• ν”λ¦¬μΌ€μ΄μ… ν—¬μ¤ μ²΄ν¬ μ—”λ“ν¬μΈνΈ. Blue/Green λ°°ν¬ μ‹ ν™μ„± μƒνƒ ν™•μΈμ— μ‚¬μ©λ©λ‹λ‹¤.

**μ”μ²­**:
```http
GET /api/health HTTP/1.1
Host: localhost:8080
```

**μ‘λ‹µ**:
```json
{
  "status": "UP",
  "timestamp": "2025-11-14T10:30:00.000+00:00"
}
```

**μƒνƒ μ½”λ“**:
- `200 OK`: μ• ν”λ¦¬μΌ€μ΄μ… μ •μƒ λ™μ‘
- `503 Service Unavailable`: μ• ν”λ¦¬μΌ€μ΄μ… λΉ„μ •μƒ μƒνƒ

**μ©λ„**:
- Blue/Green λ°°ν¬ μ‹ μ»¨ν…μ΄λ„ μ¤€λΉ„ μƒνƒ ν™•μΈ
- λ΅λ“ λ°Έλ°μ„ ν—¬μ¤ μ²΄ν¬
- λ¨λ‹ν„°λ§ μ‹μ¤ν… μ—°λ™

---

### Actuator Endpoints

Spring Boot Actuatorκ°€ ν™μ„±ν™”λμ–΄ μμ–΄ μ¶”κ°€ λ©”νΈλ¦­ μ—”λ“ν¬μΈνΈλ¥Ό μ κ³µν•©λ‹λ‹¤.

#### `GET /api/actuator/health`
μƒμ„Έ ν—¬μ¤ μ •λ³΄ μ΅°ν

**μ‘λ‹µ μμ‹**:
```json
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "PostgreSQL",
        "validationQuery": "isValid()"
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 499963174912,
        "free": 100000000000,
        "threshold": 10485760,
        "exists": true
      }
    },
    "ping": {
      "status": "UP"
    }
  }
}
```

#### `GET /api/actuator/info`
μ• ν”λ¦¬μΌ€μ΄μ… μ •λ³΄ μ΅°ν

**μ‘λ‹µ μμ‹**:
```json
{
  "app": {
    "name": "gahyeonbot",
    "version": "1.0.0",
    "description": "Discord Bot for Reservation & Music"
  }
}
```

#### `GET /api/actuator/metrics`
μ‚¬μ© κ°€λ¥ν• λ©”νΈλ¦­ λ©λ΅

**μ‘λ‹µ μμ‹**:
```json
{
  "names": [
    "jvm.memory.used",
    "jvm.threads.live",
    "http.server.requests",
    "process.uptime",
    "system.cpu.usage"
  ]
}
```

#### `GET /api/actuator/metrics/{metricName}`
νΉμ • λ©”νΈλ¦­ μƒμ„Έ μ •λ³΄

**μμ‹**: `GET /api/actuator/metrics/jvm.memory.used`

```json
{
  "name": "jvm.memory.used",
  "description": "The amount of used memory",
  "baseUnit": "bytes",
  "measurements": [
    {
      "statistic": "VALUE",
      "value": 234567890
    }
  ]
}
```

---

## Discord μ¬λμ‹ λ…λ Ήμ–΄

κ°€ν„λ΄‡μ μ£Όμ” μΈν„°νμ΄μ¤λ” Discord μ¬λμ‹ λ…λ Ήμ–΄μ…λ‹λ‹¤.

### μΌλ° λ…λ Ήμ–΄ (General)

#### `/κ°€ν„μ•„`
OpenAI GPT-4o-miniλ¥Ό μ‚¬μ©ν• AI λ€ν™” κΈ°λ¥

**νλΌλ―Έν„°**:
- `μ§λ¬Έ` (ν•„μ): AIμ—κ² λ¬Όμ–΄λ³Ό μ§λ¬Έ (μµλ€ 1000μ)

**μμ‹**:
```
/κ°€ν„μ•„ μ§λ¬Έ:μλ°”μ¤ν”„λ§λ¶€νΈμ— λ€ν•΄ μ„¤λ…ν•΄μ¤
```

**μ‘λ‹µ**:
- Discord Embed λ©”μ‹μ§€λ΅ μ§λ¬Έκ³Ό λ‹µλ³€ ν‘μ‹
- μµλ€ μ‘λ‹µ κΈΈμ΄: 2000μ (μ΄κ³Ό μ‹ μλ™ μ λ‹¨)

**Rate Limiting**:
- μ‹κ°„λ‹Ή 3ν (κ°μΈ)
- μΌμΌ 10ν (κ°μΈ)
- μΌμΌ 1000ν (μ „μ²΄)
- μ›”κ°„ 20,000ν (μ „μ²΄)

**μ—λ¬ λ©”μ‹μ§€**:
- `β οΈ μ‹κ°„λ‹Ή ν•λ„ μ΄κ³Ό`: 1μ‹κ°„ ν›„ μ¬μ‹λ„
- `β οΈ ν•λ£¨ ν•λ„ μ΄κ³Ό`: 24μ‹κ°„ ν›„ μ¬μ‹λ„
- `π« μ λ€μ  ν”„λ΅¬ν”„νΈ κ°μ§€`: μ§λ¬Έ λ‚΄μ© μμ • ν•„μ”
- `OpenAI μ„λΉ„μ¤ λΉ„ν™μ„±ν™”`: κ΄€λ¦¬μ λ¬Έμ

---

#### `/info`
λ΄‡ μ •λ³΄ λ° μ„λ²„ ν†µκ³„ μ΅°ν

**νλΌλ―Έν„°**: μ—†μ

**μ‘λ‹µ**:
- λ΄‡ λ²„μ „
- μ„λ²„ λ©¤λ²„ μ
- ν™μ„± μμ„± μ±„λ„ μ
- μ—…νƒ€μ„

---

#### `/clean`
μ±„λ„μ μµκ·Ό λ©”μ‹μ§€ μ‚­μ 

**νλΌλ―Έν„°**:
- `κ°μ` (μ„ νƒ): μ‚­μ ν•  λ©”μ‹μ§€ κ°μ (κΈ°λ³Έκ°’: 10, μµλ€: 100)

**κ¶ν•**: λ©”μ‹μ§€ κ΄€λ¦¬ κ¶ν• ν•„μ”

**μμ‹**:
```
/clean κ°μ:50
```

---

#### `/allhere`
μμ„± μ±„λ„μ λ¨λ“  μ‚¬μ©μμ—κ² μ•λ¦Ό λ©”μ‹μ§€ μ „μ†΅

**νλΌλ―Έν„°**: μ—†μ

**λ™μ‘**:
- λ…λ Ήμ–΄ μ‹¤ν–‰μκ°€ μ†ν• μμ„± μ±„λ„μ λ¨λ“  λ©¤λ²„ λ©μ…

---

### μμ•… λ…λ Ήμ–΄ (Music)

#### `/add`
μ¬μƒ λ©λ΅μ— μμ•… μ¶”κ°€

**νλΌλ―Έν„°**:
- `url` (ν•„μ): YouTube URL, Spotify URL, λλ” κ²€μƒ‰μ–΄

**μ§€μ› ν•μ‹**:
- YouTube λ™μμƒ: `https://www.youtube.com/watch?v=...`
- YouTube ν”λ μ΄λ¦¬μ¤νΈ: `https://www.youtube.com/playlist?list=...`
- Spotify νΈλ™: `https://open.spotify.com/track/...`
- κ²€μƒ‰μ–΄: `never gonna give you up`

**μμ‹**:
```
/add url:https://www.youtube.com/watch?v=dQw4w9WgXcQ
/add url:λ² ν† λ²¤ κµν–¥κ³΅ 5λ²
```

**μ‘λ‹µ**:
- μ¬μƒ λ©λ΅μ— μ¶”κ°€ ν™•μΈ λ©”μ‹μ§€
- ν„μ¬ μ¬μƒ μ¤‘μ΄ μ•„λ‹λ©΄ μ¦‰μ‹ μ¬μƒ

---

#### `/skip`
ν„μ¬ μ¬μƒ μ¤‘μΈ κ³΅ κ±΄λ„λ›°κΈ°

**νλΌλ―Έν„°**: μ—†μ

**λ™μ‘**:
- ν„μ¬ νΈλ™ μ¤‘λ‹¨
- λ‹¤μ νΈλ™ μ¬μƒ (νμ— μλ” κ²½μ°)

---

#### `/pause`
μ¬μƒ μΌμ‹ μ •μ§€

**νλΌλ―Έν„°**: μ—†μ

---

#### `/resume`
μ¬μƒ μ¬κ°

**νλΌλ―Έν„°**: μ—†μ

---

#### `/queue`
ν„μ¬ μ¬μƒ λ©λ΅ μ΅°ν

**νλΌλ―Έν„°**: μ—†μ

**μ‘λ‹µ**:
- ν„μ¬ μ¬μƒ μ¤‘μΈ κ³΅
- λ€κΈ° μ¤‘μΈ κ³΅ λ©λ΅

---

#### `/clear`
μ¬μƒ λ©λ΅ μ „μ²΄ μ‚­μ 

**νλΌλ―Έν„°**: μ—†μ

---

### κ΄€λ¦¬ λ…λ Ήμ–΄ (Moderation)

#### `/kickuser`
νΉμ • μ‚¬μ©μλ¥Ό μμ„± μ±„λ„μ—μ„ μ¶”λ°©

**νλΌλ―Έν„°**:
- `user` (ν•„μ): μ¶”λ°©ν•  μ‚¬μ©μ
- `reason` (μ„ νƒ): μ¶”λ°© μ‚¬μ 

**κ¶ν•**: λ©¤λ²„ μ¶”λ°© κ¶ν• ν•„μ”

---

#### `/kickallbots`
λ¨λ“  λ΄‡μ„ μμ„± μ±„λ„μ—μ„ μ¶”λ°©

**νλΌλ―Έν„°**: μ—†μ

**κ¶ν•**: λ©¤λ²„ μ¶”λ°© κ¶ν• ν•„μ”

---

#### `/kickallusers`
λ¨λ“  μ‚¬μ©μλ¥Ό μμ„± μ±„λ„μ—μ„ μ¶”λ°©

**νλΌλ―Έν„°**: μ—†μ

**κ¶ν•**: κ΄€λ¦¬μ κ¶ν• ν•„μ”

---

#### `/listkicks`
μμ•½λ μ¶”λ°© λ©λ΅ μ΅°ν

**νλΌλ―Έν„°**: μ—†μ

---

#### `/cancelkick`
μμ•½λ μ¶”λ°© μ·¨μ†

**νλΌλ―Έν„°**:
- `kickId` (ν•„μ): μ·¨μ†ν•  μ¶”λ°© ID

---

## μ—λ¬ μ½”λ“

### HTTP μ—λ¬
| μ½”λ“ | μλ―Έ | μ„¤λ… |
|------|------|------|
| 200 | OK | μ •μƒ μ²λ¦¬ |
| 503 | Service Unavailable | μ„λΉ„μ¤ λΉ„μ •μƒ μƒνƒ |

### Discord λ…λ Ήμ–΄ μ—λ¬
| λ©”μ‹μ§€ | μ›μΈ | ν•΄κ²° λ°©λ²• |
|--------|------|-----------|
| `μμ„± μ±„λ„μ— λ¨Όμ € μ…μ¥ν•μ„Έμ”` | μ‚¬μ©μκ°€ μμ„± μ±„λ„μ— μ—†μ | μμ„± μ±„λ„ μ…μ¥ ν›„ μ¬μ‹λ„ |
| `κ¶ν•μ΄ μ—†μµλ‹λ‹¤` | λ…λ Ήμ–΄ μ‹¤ν–‰ κ¶ν• λ¶€μ΅± | μ„λ²„ κ΄€λ¦¬μμ—κ² κ¶ν• μ”μ²­ |
| `OpenAI μ„λΉ„μ¤ λΉ„ν™μ„±ν™”` | OPENAI_API_KEY λ―Έμ„¤μ • | κ΄€λ¦¬μμ—κ² λ¬Έμ |
| `μ¬μƒ μ¤‘μΈ κ³΅μ΄ μ—†μµλ‹λ‹¤` | μμ•… μ¬μƒ μƒνƒ μ•„λ‹ | `/add`λ΅ μμ•… μ¶”κ°€ |

---

## Rate Limiting

### OpenAI API (`/κ°€ν„μ•„`)
| μ ν• μ ν• | ν•λ„ | μλ„μ° |
|-----------|------|--------|
| κ°μΈ μ‹κ°„λ‹Ή | 3ν | 1μ‹κ°„ |
| κ°μΈ μΌμΌ | 10ν | 24μ‹κ°„ |
| μ „μ²΄ μΌμΌ | 1000ν | 24μ‹κ°„ |
| μ „μ²΄ μ›”κ°„ | 20,000ν | 30μΌ |

**μ΄κ³Ό μ‹**:
- μ—λ¬ λ©”μ‹μ§€ ν‘μ‹
- λ‚¨μ€ μ‹κ°„ μ•λ‚΄
- μ”μ²­ κ±°λ¶€

### κΈ°νƒ€ λ…λ Ήμ–΄
ν„μ¬ Rate Limiting μ—†μ. ν–¥ν›„ Discord Rate Limit μ¤€μ μμ •.

---

## Webhook (ν–¥ν›„ ν™•μ¥)

### κ³„ν μ¤‘μΈ Webhook μ—”λ“ν¬μΈνΈ
- `POST /api/webhooks/github`: GitHub μ΄λ²¤νΈ μμ‹ 
- `POST /api/webhooks/stripe`: κ²°μ  μ΄λ²¤νΈ μμ‹  (ν›„μ› κΈ°λ¥)

---

## λ¨λ‹ν„°λ§ μ—°λ™

### Prometheus Metrics (ν–¥ν›„ ν™•μ¥)
```
# μμƒ λ©”νΈλ¦­
openai_requests_total{status="success|failure"}
openai_rate_limit_exceeded_total
music_tracks_played_total
commands_executed_total{command="gahyeona|add|skip"}
```

### Grafana Dashboard (ν–¥ν›„ ν™•μ¥)
- OpenAI μ‚¬μ©λ‰ μ¶”μ΄
- μμ•… μ¬μƒ ν†µκ³„
- λ…λ Ήμ–΄ μ‹¤ν–‰ λΉλ„
- μ—λ¬μ¨

---

## λ³€κ²½ μ΄λ ¥

### v1.0.0 (2025-11-14)
- μ΄κΈ° API λ¬Έμ„ μ‘μ„±
- Health Check μ—”λ“ν¬μΈνΈ λ¬Έμ„ν™”
- Discord μ¬λμ‹ λ…λ Ήμ–΄ μ „μ²΄ λ©λ΅

---

## μ°Έκ³  λ¬Έμ„
- [ARCHITECTURE.md](./ARCHITECTURE.md) - μ‹μ¤ν… μ•„ν‚¤ν…μ²
- [DEPLOYMENT.md](./DEPLOYMENT.md) - λ°°ν¬ κ°€μ΄λ“
- [Discord Developer Portal](https://discord.com/developers/docs/interactions/application-commands)
